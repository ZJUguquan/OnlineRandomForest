% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ORForest.R
\docType{data}
\name{ORF}
\alias{ORF}
\title{Create a Online Random Forest Object}
\format{\code{\link{R6Class}} object.}
\usage{
ORF$new(param, numTrees = 100)
}
\arguments{
\item{param}{A list which usually has names of \code{minSamples, minGain, numClasses, x.rng, etc.}.
More details show in \code{\link[=ORT]{Online Random Tree}}.}

\item{numTrees}{A nonnegative integer indicates how many ORT trees are going to build.}
}
\value{
Object of \code{\link{R6Class}}, Object of \code{Online Random Forest}.
}
\description{
ORF is a class of R6.
You can use it to create a \strong{random forest} via diffrent ways, which supports incremental learning as well as batch learning.
As a matter of fact, the Online Random Forest is made of a list of \code{\link[=ORT]{Online Random Trees}}.
}
\details{
Online Random Forest was first introduced by \href{http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.150.1671&rep=rep1&type=pdf}{Amir Saffari, etc}.
After that, \href{https://github.com/luiarthur/ORFpy}{Arthur Lui} has implemented the algorithm using Python.
Following the paper's advice and Lui's implemention, I refactor the code via R and R6 package. In additon,
the implemention of ORF in this package support both incremental learning and batch learning by combining with \code{\link[randomForest]{randomForest}}.
For usage, see details in description of each field or method.
}
\section{Fields}{

\describe{
\item{\code{numClasses}}{A nonnegative integer indicates how many classes when solve a classifation problem. Default 0 for regression. If numClasses > 0, then do classifation.}
\item{\code{classify}}{TRUE for classification and FALSE for Regression, depending on the value of \code{numClasses}.}
\item{\code{forest}}{A list of ORT trees. More details show in \code{\link[=ORT]{Online Random Tree}}.}
}
}

\section{Methods}{

\describe{
\item{\code{update(x, y)}}{
When a sample comes in, update all ORT trees in forest with the sample's x variables and y value. \cr
\itemize{
\item x - The x variables of a sample. Note it is an numeric vector other than a scalar.
\item y - The y value of a sample.
}
}
\item{\code{generateForest(rf, df.train, y.col)}}{
Generate a list of ORT trees, call function \code{\link[=ORT]{ORT$generateTree()}} inside.\cr
\itemize{
\item tree.mat - A tree matrix which can be obtained from \code{randomForest::getTree()}. Node that it must have a column named \strong{node.ind}. See \strong{Examples}.
\item df.train - The training data frame which has been used to contruct randomForest, i.e., the \strong{data} argument in \code{\link[randomForest]{randomForest}} function.
Note that all columns in df.train must be \strong{numeric} or \strong{integer}.
\item y.col - A character indicates which column is y, i.e., the dependent variable. Note that y column must be the last column of df.train.
}
}
\item{\code{predict(x, type = c("class", "prob"))}}{
Predict the corresponding y value of x, using all ORT trees.
\itemize{
\item x - The x variables of a sample. Note it is an numeric vector other than a scalar.
\item type - For classification only, \strong{class} means to predict y class for x, and \strong{prob} means to preict probabilities of each class that x belongs to.
}
}
\item{\code{predicts(X, type = c("class", "prob"))}}{
Predict the corresponding y value for a batch of x, using all ORT trees.
\itemize{
\item X - A matrix or a data frame corresponding to a batch of samples' x variables.
\item type - For classification only, \strong{class} means to predict y class for x, and \strong{prob} means to preict probabilities of each class that x belongs to.
}
}
\item{\code{confusionMatrix(X, y, pretty = FALSE)}}{
Get a confusion matrix about predicted y values and true y values. Only for classification problem.
\itemize{
\item X - A matrix or a data frame corresponding to a batch of samples' x variables.
\item y - A vector of y values corresponding to a batch of samples.
\item pretty - If TRUE, print a pretty confusion matrix (need \code{gmodels} package). Default FALSE.
}
}
\item{\code{meanTreeSize()}}{Mean size of ORT trees in the forest.}
\item{\code{meanNumLeaves()}}{Mean leaf nodes numbers of ORT trees in the forest.}
\item{\code{meanTreeDepth()}}{Mean depth of ORT trees in the forest.}
\item{\code{sdTreeSize()}}{Standard deviation for size of ORT trees in the forest.}
\item{\code{sdTreeSize()}}{Standard deviation for leaf nodes numbers of ORT trees in the forest.}
\item{\code{sdTreeSize()}}{Standard deviation for depth of ORT trees in the forest.}
}
}

\examples{
# classifaction example
dat <- iris; dat[,5] <- as.integer(dat[,5])
x.rng <- dataRange(dat[1:4])
param <- list('minSamples'= 2, 'minGain'= 0.2, 'numClasses'= 3, 'x.rng'= x.rng)
ind.gen <- sample(1:150,30) # for generate ORF
ind.updt <- sample(setdiff(1:150, ind.gen), 100) # for uodate ORF
ind.test <- setdiff(setdiff(1:150, ind.gen), ind.updt) # for test
rf <- randomForest::randomForest(factor(Species) ~ ., data = dat[ind.gen, ], maxnodes = 2, ntree = 100)
orf <- ORF$new(param)
orf$generateForest(rf, df.train = dat[ind.gen, ], y.col = "Species")
orf$meanTreeSize()
for (i in ind.updt) {
  orf$update(dat[i, 1:4], dat[i, 5])
}
orf$meanTreeSize()
orf$confusionMatrix(dat[ind.test, 1:4], dat[ind.test, 5], pretty = T)
# compare
table(predict(rf, newdata = dat[ind.test,]) == dat[ind.test, 5])
table(orf$predicts(X = dat[ind.test,]) == dat[ind.test, 5])


# regression example
if(!require(ggplot2)) install.packages("ggplot2")
data("diamonds", package = "ggplot2")
dat <- as.data.frame(diamonds[sample(1:53000,1000), c(1:6,8:10,7)])
for (col in c("cut","color","clarity")) dat[[col]] <- as.integer(dat[[col]]) # Don't forget !
x.rng <- dataRange(dat[1:9])
param <- list('minSamples'= 10, 'minGain'= 1, 'maxDepth' = 10, 'x.rng'= x.rng)
ind.gen <- sample(1:1000, 800)
ind.updt <- sample(setdiff(1:1000, ind.gen), 100)
ind.test <- setdiff(setdiff(1:1000, ind.gen), ind.updt)
rf <- randomForest::randomForest(price ~ ., data = dat[ind.gen, ], maxnodes = 20, ntree = 100)
orf <- ORF$new(param)
orf$generateForest(rf, df.train = dat[ind.gen, ], y.col = "price")
orf$meanTreeSize()
for (i in ind.updt) {
  orf$update(dat[i, 1:9], dat[i, 10])
}
orf$meanTreeSize()
# compare
if(!require(Metrics)) install.packages("Metrics")
preds.rf <- predict(rf, newdata = dat[ind.test,])
Metrics::rmse(preds.rf, dat$price[ind.test])
preds <- orf$predicts(dat[ind.test, 1:9])
Metrics::rmse(preds, dat$price[ind.test]) # make progress


}
\author{
Quan Gu
}
\keyword{datasets}
